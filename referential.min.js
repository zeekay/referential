var Referential=function(){"use strict";var t,e,r=Object.prototype.hasOwnProperty,n=Object.prototype.toString,i=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===n.call(t)},o=function(t){if(!t||"[object Object]"!==n.call(t))return!1;var e=r.call(t,"constructor"),i=t.constructor&&t.constructor.prototype&&r.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!i)return!1;var o;for(o in t);return"undefined"==typeof o||r.call(t,o)},u=function t(){var e,r,n,u,a,c,f=arguments[0],l=1,s=arguments.length,h=!1;for("boolean"==typeof f?(h=f,f=arguments[1]||{},l=2):("object"!=typeof f&&"function"!=typeof f||null==f)&&(f={});l<s;++l)if(e=arguments[l],null!=e)for(r in e)n=f[r],u=e[r],f!==u&&(h&&u&&(o(u)||(a=i(u)))?(a?(a=!1,c=n&&i(n)?n:[]):c=n&&o(n)?n:{},f[r]=t(h,c,u)):"undefined"!=typeof u&&(f[r]=u));return f},a=function(t){return!(null==t||!(t._isBuffer||t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)))},c=a,f=Object.prototype.toString,l=function(t){if("undefined"==typeof t)return"undefined";if(null===t)return"null";if(t===!0||t===!1||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if("undefined"!=typeof Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=f.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"undefined"!=typeof Buffer&&c(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"},s=l,h=function(t){var e=s(t);if("string"===e){if(!t.trim())return!1}else if("number"!==e)return!1;return t-t+1>=0},y=function(t){return"object"==typeof t&&null!==t};e=function(){var t;return t=0,function(){return t++}}();var p,d=t=function(){function t(t,r,n){this._value=t,this.parent=r,this.key=n,this._cache={},this._children={},this._id=e(),null!=this.parent&&(this.parent._children[this._id]=this)}return t.prototype._mutate=function(t){var e,r,n;this._cache={},n=this._children;for(r in n)e=n[r],e._mutate();return this},t.prototype.destroy=function(){var t,e,r;r=this._children;for(e in r)t=r[e],t.destroy();return delete this._cache,delete this._children,delete this.parent._children[this._id],this},t.prototype.value=function(t){return this.parent?null!=t?this.parent.set(this.key,t):this.parent.get(this.key):(null!=t&&(this._value=t),this._value)},t.prototype.ref=function(e){return e?new t(null,this,e):this},t.prototype.get=function(t){return t?this._cache[t]?this._cache[t]:this._cache[t]=this.index(t):this.value()},t.prototype.set=function(t,e){return this._mutate(t),null==e?this.value(u(this.value(),t)):this.index(t,e),this},t.prototype.extend=function(t,e){var r;return this._mutate(t),null==e?this.value(u(!0,this.value(),t)):y(e)?this.value(u(!0,this.ref(t).get(),e)):(r=this.clone(),this.set(t,e),this.value(u(!0,r.get(),this.value()))),this},t.prototype.clone=function(e){return new t(u(!0,{},this.get(e)))},t.prototype.index=function(t,e,r,n){var i,o,u;if(null==r&&(r=this.value()),this.parent)return this.parent.index(this.key+"."+t,e);if(h(t)&&(t=String(t)),u=t.split("."),null!=e)for(;o=u.shift();){if(!u.length)return r[o]=e;i=u[0],null==r[i]&&(h(i)?null==r[o]&&(r[o]=[]):null==r[o]&&(r[o]={})),r=r[o]}else for(;o=u.shift();){if(!u.length)return null!=r?r[o]:void 0;r=null!=r?r[o]:void 0}},t}();p=function(t,e){var r,n,i,o,u,a;for(null==e&&(e=null),null==e&&(e=new d(t)),a=function(t){return e.get(t)},u=["value","get","set","extend","index","ref"],r=function(t){return a[t]=function(){return e[t].apply(e,arguments)}},n=0,i=u.length;n<i;n++)o=u[n],r(o);return a.refer=function(t){return p(null,e.ref(t))},a.clone=function(t){return p(null,e.clone(t))},a},p.Ref=d;var b=p;return b}();
