!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("extend"),require("is-number"),require("is-object")):"function"==typeof define&&define.amd?define(["extend","is-number","is-object"],e):t.referential=e(t.extend,t.isNumber,t.isObject)}(this,function(t,e,n){"use strict";t="default"in t?t.default:t,e="default"in e?e.default:e,n="default"in n?n.default:n;var i,r;r=function(){var t;return t=0,function(){return t++}}();var u,l=i=function(){function i(t,e,n){this._value=t,this.parent=e,this.key=n,this._cache={},this._children={},this._id=r(),null!=this.parent&&(this.parent._children[this._id]=this)}return i.prototype._mutate=function(t){var e,n,i;this._cache={},i=this._children;for(n in i)e=i[n],e._mutate();return this},i.prototype.destroy=function(){var t,e,n;n=this._children;for(e in n)t=n[e],t.destroy();return delete this._cache,delete this._children,delete this.parent._children[this._id],this},i.prototype.value=function(t){return this.parent?null!=t?this.parent.set(this.key,t):this.parent.get(this.key):(null!=t&&(this._value=t),this._value)},i.prototype.ref=function(t){return t?new i(null,this,t):this},i.prototype.get=function(t){return t?this._cache[t]?this._cache[t]:this._cache[t]=this.index(t):this.value()},i.prototype.set=function(e,n){return this._mutate(e),null==n?this.value(t(this.value(),e)):this.index(e,n),this},i.prototype.extend=function(e,i){var r;return this._mutate(e),null==i?this.value(t(!0,this.value(),e)):n(i)?this.value(t(!0,this.ref(e).get(),i)):(r=this.clone(),this.set(e,i),this.value(t(!0,r.get(),this.value()))),this},i.prototype.clone=function(e){return new i(t(!0,{},this.get(e)))},i.prototype.index=function(t,n,i,r){var u,l,s;if(null==i&&(i=this.value()),this.parent)return this.parent.index(this.key+"."+t,n);if(e(t)&&(t=String(t)),s=t.split("."),null!=n)for(;l=s.shift();){if(!s.length)return i[l]=n;u=s[0],null==i[u]&&(e(u)?null==i[l]&&(i[l]=[]):null==i[l]&&(i[l]={})),i=i[l]}else for(;l=s.shift();){if(!s.length)return null!=i?i[l]:void 0;i=null!=i?i[l]:void 0}},i}();u=function(t,e){var n,i,r,s,h,o;for(null==e&&(e=null),null==e&&(e=new l(t)),o=function(t){return e.get(t)},h=["value","get","set","extend","index","ref"],n=function(t){return o[t]=function(){return e[t].apply(e,arguments)}},i=0,r=h.length;i<r;i++)s=h[i],n(s);return o.refer=function(t){return u(null,e.ref(t))},o.clone=function(t){return u(null,e.clone(t))},o},u.Ref=l;var s=u;return s});
